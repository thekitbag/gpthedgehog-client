import{o as w,C as _}from"./index-ce8def65.js";var R={exports:{}},E={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p;function O(){if(p)return E;p=1;var r=_,o=Symbol.for("react.element"),d=Symbol.for("react.fragment"),f=Object.prototype.hasOwnProperty,u=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function h(t,n,i){var e,l={},a=null,m=null;i!==void 0&&(a=""+i),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(m=n.ref);for(e in n)f.call(n,e)&&!c.hasOwnProperty(e)&&(l[e]=n[e]);if(t&&t.defaultProps)for(e in n=t.defaultProps,n)l[e]===void 0&&(l[e]=n[e]);return{$$typeof:o,type:t,key:a,ref:m,props:l,_owner:u.current}}return E.Fragment=d,E.jsx=h,E.jsxs=h,E}R.exports=O();var v=R.exports;const D=(r,o,d,f)=>{let u=o/(d+f),c=Math.floor(r.length/u);u>r.length&&(u=r.length,c=1);const h=[];for(let t=0;t<u;t++){let n=0;for(let i=0;i<c&&t*c+i<r.length;i++)n+=r[t*c+i];h.push(n/c)}return h},k=(r,o,d,f,u,c)=>{const h=o.height/2,t=o.getContext("2d");t&&(t.clearRect(0,0,o.width,o.height),u!=="transparent"&&(t.fillStyle=u,t.fillRect(0,0,o.width,o.height)),r.forEach((n,i)=>{t.fillStyle=c;const e=i*(d+f),l=h-n/2,a=d,m=n||1;t.beginPath(),t.roundRect(e,l,a,m,50),t.fill()}))},P=({mediaRecorder:r,width:o="100%",height:d="100%",barWidth:f=2,gap:u=1,backgroundColor:c="transparent",barColor:h="rgb(160, 198, 255)",fftSize:t=1024,maxDecibels:n=-10,minDecibels:i=-90,smoothingTimeConstant:e=.4})=>{const[l]=w.useState(()=>new AudioContext),[a,m]=w.useState(),x=w.useRef(null);w.useEffect(()=>{if(!r.stream)return;const s=l.createAnalyser();m(s),s.fftSize=t,s.minDecibels=i,s.maxDecibels=n,s.smoothingTimeConstant=e,l.createMediaStreamSource(r.stream).connect(s)},[r.stream]),w.useEffect(()=>{(a!=null?a:r.state==="recording")&&y()},[a,r.state]);const y=w.useCallback(()=>{if(!a)return;const s=new Uint8Array(a==null?void 0:a.frequencyBinCount);r.state==="recording"?(a==null||a.getByteFrequencyData(s),b(s),requestAnimationFrame(y)):r.state==="paused"?b(s):r.state==="inactive"&&l.state!=="closed"&&l.close()},[a]),b=s=>{if(!x.current)return;const g=D(s,x.current.width,f,u);k(g,x.current,f,u,c,h)};return v.jsx("canvas",{ref:x,width:o,height:d,style:{aspectRatio:"unset"}})},A=(r,o,d,f,u)=>{const c=r.getChannelData(0),h=d/(f+u),t=Math.floor(c.length/h),n=o/2;let i=[],e=0;for(let l=0;l<h;l++){const a=[];let m=0;const x=[];let y=0;for(let g=0;g<t&&l*t+g<r.length;g++){const C=c[l*t+g];C<=0&&(a.push(C),m++),C>0&&(x.push(C),y++)}const b=a.reduce((g,C)=>g+C,0)/m,s={max:x.reduce((g,C)=>g+C,0)/y,min:b};s.max>e&&(e=s.max),Math.abs(s.min)>e&&(e=Math.abs(s.min)),i.push(s)}if(n*.8>e*n){const l=n*.8/e;i=i.map(a=>({max:a.max*l,min:a.min*l}))}return i},S=(r,o,d,f,u,c,h,t=0,n=1)=>{const i=o.height/2,e=o.getContext("2d");if(!e)return;e.clearRect(0,0,o.width,o.height),u!=="transparent"&&(e.fillStyle=u,e.fillRect(0,0,o.width,o.height));const l=(t||0)/n;r.forEach((a,m)=>{const x=m/r.length,y=l>x;e.fillStyle=y&&h?h:c;const b=m*(d+f),s=i+a.min,g=d,C=i+a.max-s;e.beginPath(),e.roundRect(b,s,g,C,50),e.fill()})},$=({blob:r,width:o,height:d,barWidth:f=2,gap:u=1,currentTime:c,style:h,backgroundColor:t="transparent",barColor:n="rgb(184, 184, 184)",barPlayedColor:i="rgb(160, 198, 255)"})=>{const e=w.useRef(null),[l,a]=w.useState([]),[m,x]=w.useState(0);return w.useEffect(()=>{(async()=>{if(!e.current)return;if(!r){const b=Array.from({length:100},()=>({max:0,min:0}));S(b,e.current,f,u,t,n,i);return}const y=await r.arrayBuffer();await new AudioContext().decodeAudioData(y,b=>{if(!e.current)return;x(b.duration);const s=A(b,d,o,f,u);a(s),S(s,e.current,f,u,t,n,i)})})()},[r,e.current]),w.useEffect(()=>{e.current&&S(l,e.current,f,u,t,n,i,c,m)},[c,m]),v.jsx("canvas",{ref:e,width:o,height:d,style:{...h}})};export{$ as AudioVisualizer,P as LiveAudioVisualizer};
